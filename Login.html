<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Portal Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* KGF Theme - Dark, Gold, Gritty */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0a0a0a;
            background-image: 
                radial-gradient(circle at top left, rgba(212, 175, 55, 0.15), transparent 40%),
                radial-gradient(circle at bottom right, rgba(212, 175, 55, 0.15), transparent 40%),
                url('https://www.transparenttextures.com/patterns/concrete-wall.png');
            overflow: hidden;
        }
        .form-container {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 35px rgba(212, 175, 55, 0.2);
            animation: fadeInFromBottom 1s ease-out;
        }
        @keyframes fadeInFromBottom {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-title {
            font-family: 'Cinzel', serif;
            color: #D4AF37; /* Gold color */
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.8);
        }
        .form-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: #fff;
        }
        .form-input:focus { outline: none; border-color: #D4AF37; box-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
        .role-button {
            background: transparent; border: 1px solid rgba(212, 175, 55, 0.4); color: rgba(212, 175, 55, 0.8);
            transition: all 0.3s; cursor: pointer;
        }
        .role-button:hover { background-color: rgba(212, 175, 55, 0.1); border-color: #D4AF37; }
        .role-button.active { background-color: #D4AF37; color: #111; font-weight: bold; border-color: #D4AF37; }
        .form-button { background: linear-gradient(45deg, #D4AF37, #B8860B); color: #111; font-weight: bold; }
        .eye-icon {
            cursor: pointer;
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(212, 175, 55, 0.6);
        }
        .eye-icon:hover {
             color: #D4AF37;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md">
        <div class="form-container rounded-2xl shadow-2xl p-8">
            <form id="login-form" class="space-y-6">
                <h2 class="form-title text-3xl font-bold text-center">Portal Login</h2>
                <div id="message" class="hidden p-3 text-center text-sm rounded-lg"></div>
                <div>
                    <label for="email" class="text-sm font-medium text-gray-300 block mb-2">Email Address</label>
                    <input type="email" id="email" class="form-input w-full px-4 py-2 rounded-lg" placeholder="your_email@university.edu" required>
                </div>
                <div>
                    <label for="password" class="text-sm font-medium text-gray-300 block mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="password" class="form-input w-full px-4 py-2 rounded-lg pr-10" placeholder="••••••••" required>
                        <span id="toggle-password" class="eye-icon">
                            <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                            <svg id="eye-slashed" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
                        </span>
                    </div>
                </div>
                 <div>
                    <label class="text-sm font-medium text-gray-300 block mb-2">Select Role</label>
                    <div id="role-selector" class="grid grid-cols-3 gap-2">
                        <button type="button" data-role="Student" class="role-button p-2 rounded-lg text-sm">Student</button>
                        <button type="button" data-role="Faculty" class="role-button p-2 rounded-lg text-sm">Faculty</button>
                        <button type="button" data-role="Admin" class="role-button p-2 rounded-lg text-sm">Admin</button>
                    </div>
                </div>
                <button type="submit" class="form-button w-full py-3 font-semibold rounded-lg shadow-md">Login</button>
                <p class="text-sm text-center text-gray-300">
                    Don't have an account? <a href="signup.html" class="font-medium hover:underline text-yellow-500">Sign up</a>
                </p>
            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById('login-form');
        const messageDiv = document.getElementById('message');
        const passwordInput = document.getElementById('password');
        const togglePasswordButton = document.getElementById('toggle-password');
        const eyeOpenIcon = document.getElementById('eye-open');
        const eyeSlashedIcon = document.getElementById('eye-slashed');
        let selectedRole = 'Student'; // Default role

        // --- Role Selector Logic ---
        const roleSelector = document.getElementById('role-selector');
        const roleButtons = roleSelector.querySelectorAll('.role-button');
        
        roleButtons[0].classList.add('active'); // Set default active button

        roleSelector.addEventListener('click', (e) => {
            const targetButton = e.target.closest('.role-button');
            if (targetButton) {
                selectedRole = targetButton.dataset.role;
                roleButtons.forEach(button => button.classList.remove('active'));
                targetButton.classList.add('active');
            }
        });

        // --- Toggle Password Visibility Logic ---
        togglePasswordButton.addEventListener('click', () => {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            eyeOpenIcon.classList.toggle('hidden', isPassword);
            eyeSlashedIcon.classList.toggle('hidden', !isPassword);
        });

        // --- Form Submission Logic ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = passwordInput.value;

            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, role: selectedRole })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage(data.message, 'success');
                    
                    localStorage.setItem('authToken', data.token);

                    // Redirect based on role
                    if (data.userRole === 'Student') {
                        window.location.href = 'student.html';
                    } else if (data.userRole === 'Faculty') {
                         window.location.href = 'faculty.html';
                    } else if (data.userRole === 'Admin') {
                        window.location.href = 'admin.html';
                    }

                } else {
                    showMessage(data.message, 'error');
                }
            } catch (error) {
                showMessage('Could not connect to the server. Please try again later.', 'error');
            }
        });

        function showMessage(message, type) {
            messageDiv.textContent = message;
            const successClasses = 'bg-green-900/50 text-green-300 border border-green-500/50';
            const errorClasses = 'bg-red-900/50 text-red-300 border border-red-500/50';
            messageDiv.className = `p-3 text-center text-sm rounded-lg ${type === 'success' ? successClasses : errorClasses}`;
        }
    </script>
</body>
</html>

